<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"> 
	<head profile="http://www.w3.org/2005/10/profile"> 
		<title>Pippijn - Projects / Lang / Merr</title> 
		<meta http-equiv="content-type" content="application/xhtml+xml; charset=utf-8"/> 
		<meta http-equiv="content-style-type" content="text/css"/> 
		<meta name="description" content="Pippijn van Steenhoven - Projects / Lang / Merr"/> 
		<link rel="stylesheet" href="/home/css/home.css" type="text/css" title="Clean Blue" media="screen"/> 
		<link rel="icon" type="image/x-icon" href="/home/favicon.ico"/>
	</head> 

	<body> 
		<div id="header"> 
			<h1>Pippijn van Steenhoven</h1> 
			<p id="slogan">I doubt, therefore I might be</p> 
		</div> 

		<div id="sidebar"> 
			<h2>Menu</h2> 
			<div id="menubar">
				<ul>
  <li>
    <a href="/home/">Home</a>
  </li>
  <li>
    <a href="/home/projects">Projects
      <span class="small">[-]</span>
    </a>
    <ul>
      <li>
        <a href="/home/projects/devel">Developer tools
          <span class="small">[+]</span>
        </a>
      </li>
      <li>
        <a href="/home/projects/edu">Education
          <span class="small">[+]</span>
        </a>
      </li>
      <li>
        <a href="/home/projects/games">Games
          <span class="small">[+]</span>
        </a>
      </li>
      <li>
        <a href="/home/projects/net">Network
          <span class="small">[+]</span>
        </a>
      </li>
      <li>
        <a href="/home/projects/lang">Languages
          <span class="small">[-]</span>
        </a>
        <ul>
          <li>
            <a href="/home/projects/lang/aldor">Aldor
              <span class="small">[+]</span>
            </a>
          </li>
          <li>
            <a href="/home/projects/lang/ccparse">CParseParse
              <span class="small">[+]</span>
            </a>
          </li>
          <li>
            <a href="/home/projects/lang/cparser">C Parser
              <span class="small">[+]</span>
            </a>
          </li>
          <li>
            <a href="/home/projects/lang/glr">GLR Parser
              <span class="small">[+]</span>
            </a>
          </li>
          <li>
            <a href="/home/projects/lang/hm">Hindley-Milner
              <span class="small">[+]</span>
            </a>
          </li>
          <li>
            <a href="/home/projects/lang/jmlc">JML</a>
          </li>
          <li>
            <a id="actmenu">Meta-Error</a>
          </li>
          <li>
            <a href="/home/projects/lang/re2ml">Re2ML</a>
          </li>
          <li>
            <a href="/home/projects/lang/libcdk">CDK library</a>
          </li>
          <li>
            <a href="/home/projects/lang/rasm">Runtime assembler</a>
          </li>
          <li>
            <a href="/home/projects/lang/safe">Safe C
              <span class="small">[+]</span>
            </a>
          </li>
          <li>
            <a href="/home/projects/lang/treematch">Treematch
              <span class="small">[+]</span>
            </a>
          </li>
          <li>
            <a href="/home/projects/lang/xul">XUL Projects</a>
          </li>
          <li>
            <a href="/home/projects/lang/yaccpp">YACC Preprocessor</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/home/projects/robotics">Robotics
          <span class="small">[+]</span>
        </a>
      </li>
      <li>
        <a href="/home/projects/system">Systems
          <span class="small">[+]</span>
        </a>
      </li>
    </ul>
  </li>
  <li>
    <a href="/home/opinions">Opinions
      <span class="small">[+]</span>
    </a>
  </li>
  <li>
    <a href="/home/programming">Programming
      <span class="small">[+]</span>
    </a>
  </li>
  <li>
    <a href="/home/links">Links</a>
  </li>
  <li>
    <a href="/home/contact">Contact</a>
  </li>
</ul>
			</div> 
		</div> 

		<div id="content">
			<h2>Meta-Error

</h2> <p>Merr (Meta-ERRor) is a syntax error message generator for LR parsers. It passes
samples of erroneous input to the parser and produces an error message function
that produces the error message written in the sample file when the same syntax
error occurs again.  with a modified version of the menhir parser generator.
Adapting other parser generators such as ocamlyacc is probably not difficult.
The modified menhir can be found at https://github.com/pippijn/menhir.

</p> <p>This tool is based on ideas from Clinton Jeffery's "merr" tool at
http://unicon.sourceforge.net/merr/. It is recommended to read the technical
paper introducing the concepts.

</p> <p>
  <a href="https://github.com/pippijn/merr">Git repository</a>


</p> <h3>Usage

</h3> <p>The merr program takes several inputs to produce its error message function
from.

</p> <pre class="verbatim">-t &lt;terminals&gt;
-e &lt;errors.ml.in&gt;
-a &lt;automaton&gt;
-p &lt;parser command&gt;
-o &lt;output.ml&gt;</pre> <h4>Terminal names

</h4> <p>The terminals file contains an ocamlyacc grammar or tokens file amended with
token names. An extract of this file could look like this:

</p> <pre class="code-block"><span class="Conceal">∘</span>token<span class="Statement">&lt;</span><span class="Type">string</span><span class="Statement">&gt;</span>  <span class="Constant">TkIDENTIFIER</span>    <span class="String">&quot;identifier&quot;</span>
<span class="Conceal">∘</span>token          <span class="Constant">TkIF</span>            <span class="String">&quot;if&quot;</span>
<span class="Conceal">∘</span>token          <span class="Constant">TkTHEN</span>          <span class="String">&quot;then&quot;</span>
<span class="Conceal">∘</span>token          <span class="Constant">TkELSE</span>          <span class="String">&quot;else&quot;</span></pre> <p>Merr uses these strings when producing default error messages, so that the user
doesn't see the internal names like "TkIDENTIFIER". Since menhir doesn't
understand these extra string literals after the token name, the grammar file
needs to be preprocessed before passing it to the parser generator. A simple

  <code>sed -e 's/^\(%token[^"]*\w\+\)\s*".*"$/\1/'</code> will safely remove the string
literals as well as leading whitespace. This can be done in a 
  <code>make</code> target
like 
  <code>%.mly: %.mly.in</code>.


</p> <h4>Sample file

</h4> <p>The second input expected by merr is the sample file. Merr works by passing each
sample input to the parser, which should be instrumented to print a pair of

  <code>(state, token)</code> to its standard output. The 
  <code>state</code> should be a number, and

  <code>token</code> is the token type constructor name, e.g. 
  <code>TkIF</code>.


</p> <p>The parser should have a flag to disable error messages and print this
state/token pair. The parser command and this flag should be passed to merr with
the 
  <code>-p</code> command line option.


</p> <p>The sample file has a similar syntax as OCaml itself. The following is an
excerpt from merr's own error description.

</p> <pre class="code-block"><span class="Statement">module</span><span class="Include"> Tokens</span> <span class="Statement">=</span> <span class="Include">Etokens</span>
<span class="Statement">open</span> <span class="Include">Etoken</span> <span class="Comment">(* provides string_of_token *)</span>
<span class="Statement">open</span> <span class="Include">Tokens</span> <span class="Comment">(* provides the 'token' type *)</span>

<span class="Statement">let</span> message <span class="Statement">=</span> <span class="Conceal">λ</span>
  <span class="Statement">|</span> <span class="String">&quot;open&quot;</span> <span class="Conceal">→</span> <span class="Conceal">λ</span>
    <span class="Statement">|</span> <span class="Constant">EOF</span>               <span class="Conceal">→</span> <span class="String">&quot;expected module name after 'open'&quot;</span>
    <span class="Statement">|</span> <span class="Constant">TkIDENTIFIER</span>      <span class="Conceal">→</span> <span class="String">&quot;unexpected identifier `%s' after 'open'&quot;</span>
                           <span class="String">&quot;expected module name (capitalised)&quot;</span>
    <span class="Statement">|</span> <span class="Statement">_</span>                 <span class="Conceal">→</span> <span class="String">&quot;unexpected token '%s' in handler definition&quot;</span>

  <span class="Statement">|</span> <span class="String">&quot;open Foo let message = function&quot;</span> <span class="Conceal">→</span> <span class="Conceal">λ</span>
    <span class="Statement">|</span> <span class="Constant">EOF</span>                 <span class="Conceal">→</span> <span class="String">&quot;expected '|'-separated code fragments&quot;</span>
    <span class="Statement">|</span> <span class="Statement">_</span>                   <span class="Conceal">→</span> <span class="String">&quot;unexpected token '%s' where code fragments expected&quot;</span>
</pre> <p>One or more 
  <code>open</code> directives are always required, and the opened modules
should provide the function 
  <code>val string_of_token : token -&gt; string</code> and
bring the token type constructors into scope. Merr can generate a default
function that return the strings in the terminals file, but usually you will
want a better description, using the token data. There can be any number of

  <code>open</code> and 
  <code>module</code> directives


</p> <p>In error messages, the 
  <code>%s</code> part of the message is replaced by the application
of 
  <code>string_of_token</code> with the erroneous token. So, for instance if that
function returns the 
  <code>string</code> argument of the 
  <code>TkIDENTIFIER</code> constructor, the
identifier can be printed in the error message.


</p> <p>Error messages can consist of multiple consecutive format strings. In the error
message returned from the generated error function, these are joined with the
new-line character 
  <code>'\n'</code>.


</p> <p>The top-level patterns contain erroneous sample input to be passed to the
parser. The inner match dispatches over the current parser token, and a default
catch-all case can be assigned that only regards the state, not the token.
Instead of a nested match, one can also write the message directly after the
code sample. Multi-matches are also possible, if you want the same error
handling for multiple distinct code samples (and therefore states).

</p> <p>Merr will check that all code samples are unique in that they arrive at
different states in the parser, so that there can be no ambiguities about which
error message to display for a given error.

</p> <h4>Automaton file

</h4> <p>As a secondary source of error messages, the merr program will try to find out
what tokens would allow a shift action in the parser. It will present the user
with a list of token names (from the terminals file) that the parser might
expect at the state where the error occurred. Menhir can produce an automaton
description parseable by merr, using the option 
  <code>-dump</code>.


</p> <h4>Using the function

</h4> <p>After the parser has been run on the inputs and the error message function has
been generated, it can be called when an error occurs in the parser. The
modified menhir parser will raise an exception 
  <code>StateError of int * token</code>
where 
  <code>token</code> is the token type used by the parser and the first argument is
the state. These two can be passed to the error function with the type signature

  <code>val message : int -&gt; token -&gt; string</code>. Further formatting can be done in
the client of the error module.


</p> <h4>Ocamlbuild integration

</h4> <p>Merr can be easily integrated with 
  <code>ocamlbuild</code>. See its own 
  <code>myocamlbuild.ml</code>
and 
  <code>_tags</code> files to understand how to do that.

</p>
		</div> 

		<div id="footer"> 
			<div id="copyright"><a href="/home/contact">Copyright &copy; 2007-2013 Pippijn van Steenhoven</a></div> 
			<div id="updated">Last updated Wed Aug 14 04:45:30 MEST 2013</div> 
		</div> 
	</body> 
</html> 
