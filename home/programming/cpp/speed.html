<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"> 
	<head> 
		<title>Pippijn - Programming / Cpp / Speed</title> 
		<meta http-equiv="content-type" content="application/xhtml+xml; charset=utf-8"/> 
		<meta http-equiv="content-style-type" content="text/css"/> 
		<meta name="description" content="Pippijn van Steenhoven - Programming / Cpp / Speed"/> 
		<link rel="stylesheet" href="/~pippijn/static/css/home.css" type="text/css" title="Clean Blue" media="screen"/> 
		<link rel="icon" type="image/x-icon" href="/~pippijn/static/favicon.ico"/>
	</head> 

	<body> 
		<div id="header"> 
			<h1>Pippijn van Steenhoven</h1> 
			<p id="slogan">I doubt, therefore I might be</p> 
		</div> 

		<div id="sidebar"> 
			<h2>Menu</h2> 
			<div id="menubar">
				<ul>
<li>
<a href="/home/index">Home</a></li><li>
<a href="/home/projects">Projects <span class="small">[+]</span></a></li><li>
<a href="/home/programming">Programming <span class="small">[-]</span></a><ul>
<li>
<a href="/home/programming/data-hiding">Data hiding</a></li><li>
<a href="/home/programming/c">C <span class="small">[+]</span></a></li><li>
<a href="/home/programming/cpp">C++ <span class="small">[-]</span></a><ul>
<li>
<a href="/home/programming/cpp/properties">Properties</a></li></ul></li></ul></li><li>
<a href="/home/links">Links</a></li><li>
<a href="/home/contact">Contact</a></li></ul>
			</div> 
		</div> 

		<div id="content">
			<h2>
C++ speed</h2>
<ul><li><a href='#h1'>Inheritance</a></li>
<li><a href='#h2'>Member functions</a></li>
<li><a href='#h3'>Virtual function calls</a></li></ul><p class='small'>This article assumes you know the C and C++ syntax.

</p><p>
In the past, many people have either asked me whether C is faster than C++ or
explicitly told me that C is in fact faster than C++. Other people have said,
C++ is faster than C and pointed at templates. In this article, I will try to
evaluate the truth of both opinions. In order to do this, I will present a few
C++ features and possible implementations of them in C.</p>
<h3>
<a id='h1'>Inheritance</a></h3>
<p>
In C++, there is the possibility of <acronym title="Classes are user defined
 types defined with the 'class' or 'struct' keyword">class</acronym>es
inheriting members from other classes. A simple example of this in C++ would
be:</p>
<pre class="code-block">  <span class="key3">struct</span> Base
  {
    <span class="key3">int</span> a;
  };

  <span class="key3">struct</span> Derived : Base
  {
    <span class="key3">int</span> b;
  };

  <span class="comment">// Now, we can have an object of type Derived and modify its data members</span>
  <span class="comment">// a and b directly.</span>
  Derived d;
  d.a = <span class="number">3</span>;
  d.b = <span class="number">4</span>;
  <span class="comment">// This object can be implicitly converted to a Base reference</span>
  Base &amp;b = d;

</pre><p>
How is this done in C? For inheritance, there are basically two possibilities
of which one has two variations. The first possibility is to give <span class='code'>Derived</span>
an object of type <span class='code'>Base</span> as its first member. This has the advantage of less
code duplication and the disadvantage of having to know more about the class'
layout in client code. The second possibility is to simply include all data
members of <span class='code'>Base</span> in <span class='code'>Derived</span>, either by copy-pasting them or by defining
the body of <span class='code'>Base</span> in a header file and including that inside <span class='code'>Derived</span>.</p>
<h5>
Possibility 1</h5>
<pre class="code-block">  <span class="key3">struct</span> Base
  {
    <span class="key3">int</span> a;
  };

  <span class="key3">struct</span> Derived
  {
    <span class="key3">struct</span> Base base;
    <span class="key3">int</span> b;
  };

  <span class="comment">// Define an object of type Derived</span>
  <span class="key3">struct</span> Derived d;
  d.base.a = <span class="number">3</span>; <span class="comment">// or: ((struct Base *)&amp;d)-&gt;a = 3;</span>
  d.b = <span class="number">4</span>;
  <span class="comment">// We can either explicitly convert a pointer to this object to Base</span>
  <span class="key3">struct</span> Base *b = (<span class="key3">struct</span> Base *)&amp;d;
  <span class="comment">// or take the address of the base object</span>
  <span class="key3">struct</span> Base *b = &amp;d.base;

</pre><h5>
Possibility 2</h5>
<pre class="code-block">  <span class="key3">struct</span> Base
  {
    <span class="key3">int</span> a;
  };

  <span class="key3">struct</span> Derived
  {
    <span class="key3">int</span> a;
    <span class="key3">int</span> b;
  };

  <span class="comment">// Or:</span>
  <span class="key3">struct</span> Base
  {
  #<span class="key2">include</span> <span class="string">"Base_body.h"</span>
  };

  <span class="key3">struct</span> Derived
  {
  #<span class="key2">include</span> <span class="string">"Base_body.h"</span>
  #<span class="key2">include</span> <span class="string">"Derived_body.h"</span>
  };

  <span class="comment">// Define an object of type Derived</span>
  <span class="key3">struct</span> Derived d;
  d.a = <span class="number">3</span>;
  d.b = <span class="number">4</span>;
  <span class="comment">// We can explicitly convert a pointer to this object to Base</span>
  <span class="key3">struct</span> Base *b = (<span class="key3">struct</span> Base *)&amp;d;

</pre><p>
Multiple inheritance can be achieved in C, but not by <span class='code'>#include</span>ing the
multiple bases' bodies. That would break casts to those bases. It is possible
to <span class='code'>#include</span> the first base, but the others need to be included as objects
like in the first possibility. That of course makes the client code ugly,
because it has to know intimate details about the class layout or use accessor
and mutator functions all the time.</p>
<h3>
<a id='h2'>Member functions</a></h3>
<p>
C++ has the notion of (non-static) member functions, which are like normal
functions except they are called "on" an object. By calling a non-static
member function on an object, you in fact pass a pointer to the object as
argument to the invisible first parameter called <span class='code'>this</span>. You can do that in
C, too, except that the syntax looks a bit different:</p>
<pre class="code-block">  <span class="comment">// C++</span>
  <span class="key3">struct</span> Base
  {
    <span class="key3">int</span> a;
    <span class="key3">void</span> foo () { a = <span class="number">3</span>; }
  };

  <span class="key3">struct</span> Derived : Base
  {
    <span class="key3">int</span> b;
  };

  Derived d;
  d.foo ();
  Base &amp;b = d;
  b.foo ();

  <span class="comment">// C:</span>
  <span class="key3">struct</span> Base
  {
    <span class="key3">int</span> a;
  };

  <span class="key3">static</span> <span class="key3">void</span> Base_foo (<span class="key3">struct</span> Base *<span class="key1">this</span>) { <span class="key1">this</span>-&gt;a = <span class="number">3</span>; }

  <span class="key3">struct</span> Derived
  {
    <span class="key3">int</span> a;
    <span class="key3">int</span> b;
  };

  <span class="key3">struct</span> Derived d;
  Base_foo ((<span class="key3">struct</span> Base *)&amp;d);
  <span class="key3">struct</span> Base *b = &amp;d;
  Base_foo (b);

</pre><p>
If you want to override <span class='code'>foo()</span> in <span class='code'>Derived</span>, in C++ you simply mention
<span class='code'>void foo()</span> in <span class='code'>Derived</span>'s class definition. In C, you need to modify all
callers, as well as adding a <span class='code'>Derived_foo()</span>. The problems arise when virtual
function calls are used.</p>
<h3>
<a id='h3'>Virtual function calls</a></h3>
<p>
Until now, the C and C++ implementation have been reasonably equal in both
development time and execution time. With compiler optimisation, both generate
almost equal code (note that in this special case, the compiler will likely
optimise away everything and <span class='code'>main()</span> will become a <span class='code'>return 0</span> statement.</p>

		</div> 

		<div id="footer"> 
			<div id="copyright"><a href="/~pippijn/home/contact">Copyright &copy; 2007-2011 Pippijn van Steenhoven</a></div> 
			<div id="updated">Last updated Thu May 26 20:36:24 MEST 2011</div> 
		</div> 
	</body> 
</html> 
